const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/svgMap.min.BwHRSfpZ.js","assets/speedtest.Cf2juqOf.js","assets/svgmap.DfM-daxN.js","assets/svgMap-Cq7cmgUt.css"])))=>i.map(i=>d[i]);
import{a as M}from"./index-CuWL2HxC.js";import{u as S,d as h,r as P,k as r,p as e,s as m,y as n,z as u,v as g,E as D,J as N,F as f,A as k,l,C as A}from"./vendor.DHFmOzci.js";import{u as L}from"./utils/utils-auth.Cj4TPQPL.js";import{t as j}from"./utils/utils-analytics.BMWz_Cy8.js";import{g as B}from"./utils/utils-data.CC01m_V6.js";import"./utils/utils-getips.B2avacMe.js";import"./speedtest.Cf2juqOf.js";const V={class:"ping-test-section my-4"},O={class:"text-secondary"},Z={key:0},F={class:"row"},G={class:"col-12 mb-3"},H={class:"card-body"},U={class:"row mt-3 mb-3 align-items-center justify-content-center"},J={class:"col-12 col-md-auto"},$={for:"pingIP",class:"col-form-label"},q={class:"col-12 col-md-auto mt-2 mt-md-0"},z={class:"input-group"},W={disabled:"",value:""},K=["value"],Q=["disabled"],X={key:0},Y={key:1,class:"spinner-grow spinner-grow-sm","aria-hidden":"true"},tt={key:0,id:"pingresult"},et={class:"table-responsive text-nowrap"},st={key:1,id:"pingresult-error"},ot=["data-bs-theme"],pt={__name:"GlobalLatencyTest",setup(at){const{t:o}=S(),v=L(),_=h(()=>v.isDarkMode),w=h(()=>v.isMobile),x=h(()=>v.lang);let E=h(()=>v.allIPs.filter(a=>a&&!a.includes(" ")));const y=P(""),d=P([]),i=P("idle"),T=()=>{j("Section","StartClick","GlobalLatency"),d.value=[],R();let c=0;const a=async()=>{i.value="running";try{const s=await fetch("https://api.globalping.io/v1/measurements",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({limit:16,locations:[{country:"HK"},{country:"TW"},{country:"CN"},{country:"JP"},{country:"SG"},{country:"IN"},{country:"RU"},{country:"US"},{country:"CA"},{country:"AU"},{country:"GB"},{country:"DE"},{country:"FR"},{country:"BR"},{country:"ZA"},{country:"SA"}],target:y.value,type:"ping",measurementOptions:{packets:8}})});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);return await s.json()}catch(s){console.error("Error sending ping request:",s)}},t=async s=>{try{const p=await fetch(`https://api.globalping.io/v1/measurements/${s}`);if(!p.ok)throw new Error(`HTTP error! status: ${p.status}`);const b=await p.json();I(b),b.status==="in-progress"&&c<4?(setTimeout(()=>t(s),1e3),c++):d.value.length===0?i.value="error":(i.value="finished",C())}catch(p){console.error("Error fetching ping results:",p)}};a().then(s=>{s&&s.id&&setTimeout(()=>{t(s.id)},1e3)})},I=c=>{const a=c.results.filter(t=>t.result.status==="finished").filter(t=>t.result.stats.min!==null).map(t=>({country:t.probe.country,country_name:B(t.probe.country,x.value),stats:t.result.stats}));d.value=a},C=async()=>{const c=await M(()=>import("./svgMap.min.BwHRSfpZ.js").then(t=>t.s),__vite__mapDeps([0,1,2]));await M(()=>Promise.resolve({}),__vite__mapDeps([3]));const a={data:{avgPing:{name:o("pingtest.AvgDelay"),format:"{0} ms",thresholdMax:250,thresholdMin:0},minPing:{name:o("pingtest.MinDelay"),format:"{0} ms"},maxPing:{name:o("pingtest.MaxDelay"),format:"{0} ms"},total:{name:o("pingtest.TotalPackets"),format:"{0}"},loss:{name:o("pingtest.PacketLoss"),format:"{0}%"},rcv:{name:o("pingtest.ReceivedPackets"),format:"{0}"},drop:{name:o("pingtest.DroppedPackets"),format:"{0}"}},applyData:"avgPing",values:{}};d.value.forEach(t=>{a.values[t.country]={avgPing:t.stats.avg,minPing:t.stats.min,maxPing:t.stats.max,total:t.stats.total,loss:t.stats.loss,rcv:t.stats.rcv,drop:t.stats.drop}}),new c.default({targetElementID:"svgMap",data:a,colorMax:"#083923",colorMin:"#22CB80",minZoom:1,maxZoom:1,mouseWheelZoomEnabled:!1,initialZoom:1})},R=()=>{document.getElementById("svgMap").innerHTML=""};return(c,a)=>(l(),r("div",V,[e("div",O,[e("p",null,n(u(o)("pingtest.Note")),1),w.value?m("",!0):(l(),r("p",Z,n(u(o)("pingtest.Note2")),1))]),e("div",F,[e("div",G,[e("div",{class:g(["card jn-card",{"dark-mode dark-mode-border":_.value}])},[e("div",H,[e("div",U,[e("div",J,[e("label",$,n(u(o)("pingtest.Note3")),1)]),e("div",q,[e("div",z,[D(e("select",{id:"pingIP","aria-label":"Select IP to Ping",class:g(["form-select jn-ping-form-select",{"bg-dark text-light":_.value}]),"onUpdate:modelValue":a[0]||(a[0]=t=>y.value=t)},[e("option",W,n(u(o)("pingtest.SelectIP")),1),(l(!0),r(f,null,k(u(E),t=>(l(),r("option",{key:t,value:t},n(t),9,K))),128))],2),[[N,y.value]]),e("button",{class:"btn btn-primary",onClick:T,disabled:i.value==="running"||y.value===""},[i.value==="idle"||i.value==="finished"||i.value==="error"?(l(),r("span",X,n(u(o)("pingtest.Run")),1)):m("",!0),i.value==="running"?(l(),r("span",Y)):m("",!0)],8,Q)])])]),d.value.length>0?(l(),r("div",tt,[e("div",et,[e("table",{class:g(["table table-hover",{"table-dark":_.value}])},[e("thead",null,[e("tr",null,[(l(),r(f,null,k(["Region","MinDelay","MaxDelay","AvgDelay","TotalPackets","PacketLoss","ReceivedPackets","DroppedPackets"],t=>e("th",{scope:"col",key:t},n(u(o)("pingtest."+t)),1)),64))])]),e("tbody",null,[(l(!0),r(f,null,k(d.value,t=>(l(),r("tr",{key:t.country},[e("td",null,[e("span",{class:g("jn-fl fi fi-"+t.country.toLowerCase())},null,2),A(" "+n(t.country_name),1)]),(l(),r(f,null,k(["min","max","avg"],s=>e("td",{key:s,class:g(t.stats[s]<100?"text-success":"")},n(t.stats[s].toFixed(1)),3)),64)),e("td",null,n(t.stats.total),1),e("td",null,n(Math.round(t.stats.loss))+"%",1),e("td",null,n(t.stats.rcv),1),e("td",null,n(t.stats.drop),1)]))),128))])],2)])])):m("",!0),a[1]||(a[1]=e("div",{id:"svgMap"},null,-1)),i.value==="error"?(l(),r("div",st,[e("div",{class:"alert alert-info","data-bs-theme":_.value?"dark":""},n(u(o)("pingtest.Error")),9,ot)])):m("",!0)])],2)])])]))}};export{pt as default};
