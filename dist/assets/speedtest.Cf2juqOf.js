var $e=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Vn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var B=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof global<"u"&&global||{},F={searchParams:"URLSearchParams"in B,iterable:"Symbol"in B&&"iterator"in Symbol,blob:"FileReader"in B&&"Blob"in B&&(function(){try{return new Blob,!0}catch{return!1}})(),formData:"FormData"in B,arrayBuffer:"ArrayBuffer"in B};function Xn(e){return e&&DataView.prototype.isPrototypeOf(e)}if(F.arrayBuffer)var Zn=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],Kn=ArrayBuffer.isView||function(e){return e&&Zn.indexOf(Object.prototype.toString.call(e))>-1};function ke(e){if(typeof e!="string"&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||e==="")throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function Vt(e){return typeof e!="string"&&(e=String(e)),e}function Xt(e){var t={next:function(){var n=e.shift();return{done:n===void 0,value:n}}};return F.iterable&&(t[Symbol.iterator]=function(){return t}),t}function D(e){this.map={},e instanceof D?e.forEach(function(t,n){this.append(n,t)},this):Array.isArray(e)?e.forEach(function(t){if(t.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+t.length);this.append(t[0],t[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}D.prototype.append=function(e,t){e=ke(e),t=Vt(t);var n=this.map[e];this.map[e]=n?n+", "+t:t};D.prototype.delete=function(e){delete this.map[ke(e)]};D.prototype.get=function(e){return e=ke(e),this.has(e)?this.map[e]:null};D.prototype.has=function(e){return this.map.hasOwnProperty(ke(e))};D.prototype.set=function(e,t){this.map[ke(e)]=Vt(t)};D.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)};D.prototype.keys=function(){var e=[];return this.forEach(function(t,n){e.push(n)}),Xt(e)};D.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),Xt(e)};D.prototype.entries=function(){var e=[];return this.forEach(function(t,n){e.push([n,t])}),Xt(e)};F.iterable&&(D.prototype[Symbol.iterator]=D.prototype.entries);function wt(e){if(!e._noBody){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}}function Mn(e){return new Promise(function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function Qn(e){var t=new FileReader,n=Mn(t);return t.readAsArrayBuffer(e),n}function Yn(e){var t=new FileReader,n=Mn(t),r=/charset=([A-Za-z0-9_-]+)/.exec(e.type),a=r?r[1]:"utf-8";return t.readAsText(e,a),n}function er(e){for(var t=new Uint8Array(e),n=new Array(t.length),r=0;r<t.length;r++)n[r]=String.fromCharCode(t[r]);return n.join("")}function rn(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function Pn(){return this.bodyUsed=!1,this._initBody=function(e){this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?typeof e=="string"?this._bodyText=e:F.blob&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:F.formData&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:F.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():F.arrayBuffer&&F.blob&&Xn(e)?(this._bodyArrayBuffer=rn(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):F.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||Kn(e))?this._bodyArrayBuffer=rn(e):this._bodyText=e=Object.prototype.toString.call(e):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof e=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):F.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},F.blob&&(this.blob=function(){var e=wt(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var e=wt(this);return e||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(F.blob)return this.blob().then(Qn);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var e=wt(this);if(e)return e;if(this._bodyBlob)return Yn(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(er(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},F.formData&&(this.formData=function(){return this.text().then(rr)}),this.json=function(){return this.text().then(JSON.parse)},this}var tr=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function nr(e){var t=e.toUpperCase();return tr.indexOf(t)>-1?t:e}function he(e,t){if(!(this instanceof he))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');t=t||{};var n=t.body;if(e instanceof he){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new D(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,!n&&e._bodyInit!=null&&(n=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",(t.headers||!this.headers)&&(this.headers=new D(t.headers)),this.method=nr(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal||(function(){if("AbortController"in B){var s=new AbortController;return s.signal}})(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&n)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(n),(this.method==="GET"||this.method==="HEAD")&&(t.cache==="no-store"||t.cache==="no-cache")){var r=/([?&])_=[^&]*/;if(r.test(this.url))this.url=this.url.replace(r,"$1_="+new Date().getTime());else{var a=/\?/;this.url+=(a.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}he.prototype.clone=function(){return new he(this,{body:this._bodyInit})};function rr(e){var t=new FormData;return e.trim().split("&").forEach(function(n){if(n){var r=n.split("="),a=r.shift().replace(/\+/g," "),s=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(a),decodeURIComponent(s))}}),t}function ir(e){var t=new D,n=e.replace(/\r?\n[\t ]+/g," ");return n.split("\r").map(function(r){return r.indexOf(`
`)===0?r.substr(1,r.length):r}).forEach(function(r){var a=r.split(":"),s=a.shift().trim();if(s){var c=a.join(":").trim();try{t.append(s,c)}catch(u){console.warn("Response "+u.message)}}}),t}Pn.call(he.prototype);function Y(e,t){if(!(this instanceof Y))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(t||(t={}),this.type="default",this.status=t.status===void 0?200:t.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=t.statusText===void 0?"":""+t.statusText,this.headers=new D(t.headers),this.url=t.url||"",this._initBody(e)}Pn.call(Y.prototype);Y.prototype.clone=function(){return new Y(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new D(this.headers),url:this.url})};Y.error=function(){var e=new Y(null,{status:200,statusText:""});return e.ok=!1,e.status=0,e.type="error",e};var ar=[301,302,303,307,308];Y.redirect=function(e,t){if(ar.indexOf(t)===-1)throw new RangeError("Invalid status code");return new Y(null,{status:t,headers:{location:e}})};var le=B.DOMException;try{new le}catch{le=function(t,n){this.message=t,this.name=n;var r=Error(t);this.stack=r.stack},le.prototype=Object.create(Error.prototype),le.prototype.constructor=le}function Sn(e,t){return new Promise(function(n,r){var a=new he(e,t);if(a.signal&&a.signal.aborted)return r(new le("Aborted","AbortError"));var s=new XMLHttpRequest;function c(){s.abort()}s.onload=function(){var d={statusText:s.statusText,headers:ir(s.getAllResponseHeaders()||"")};a.url.indexOf("file://")===0&&(s.status<200||s.status>599)?d.status=200:d.status=s.status,d.url="responseURL"in s?s.responseURL:d.headers.get("X-Request-URL");var l="response"in s?s.response:s.responseText;setTimeout(function(){n(new Y(l,d))},0)},s.onerror=function(){setTimeout(function(){r(new TypeError("Network request failed"))},0)},s.ontimeout=function(){setTimeout(function(){r(new TypeError("Network request timed out"))},0)},s.onabort=function(){setTimeout(function(){r(new le("Aborted","AbortError"))},0)};function u(d){try{return d===""&&B.location.href?B.location.href:d}catch{return d}}if(s.open(a.method,u(a.url),!0),a.credentials==="include"?s.withCredentials=!0:a.credentials==="omit"&&(s.withCredentials=!1),"responseType"in s&&(F.blob?s.responseType="blob":F.arrayBuffer&&(s.responseType="arraybuffer")),t&&typeof t.headers=="object"&&!(t.headers instanceof D||B.Headers&&t.headers instanceof B.Headers)){var o=[];Object.getOwnPropertyNames(t.headers).forEach(function(d){o.push(ke(d)),s.setRequestHeader(d,Vt(t.headers[d]))}),a.headers.forEach(function(d,l){o.indexOf(l)===-1&&s.setRequestHeader(l,d)})}else a.headers.forEach(function(d,l){s.setRequestHeader(l,d)});a.signal&&(a.signal.addEventListener("abort",c),s.onreadystatechange=function(){s.readyState===4&&a.signal.removeEventListener("abort",c)}),s.send(typeof a._bodyInit>"u"?null:a._bodyInit)})}Sn.polyfill=!0;B.fetch||(B.fetch=Sn,B.Headers=D,B.Request=he,B.Response=Y);var bt,an;function sr(){return an||(an=1,bt=self.fetch.bind(self)),bt}sr();var _t,sn;function or(){if(sn)return _t;sn=1;var e="Expected a function",t="__lodash_hash_undefined__",n="[object Function]",r="[object GeneratorFunction]",a=/[\\^$.*+?()[\]{}|]/g,s=/^\[object .+?Constructor\]$/,c=typeof $e=="object"&&$e&&$e.Object===Object&&$e,u=typeof self=="object"&&self&&self.Object===Object&&self,o=c||u||Function("return this")();function d(h,v){return h?.[v]}function l(h){var v=!1;if(h!=null&&typeof h.toString!="function")try{v=!!(h+"")}catch{}return v}var g=Array.prototype,M=Function.prototype,w=Object.prototype,O=o["__core-js_shared__"],A=(function(){var h=/[^.]+$/.exec(O&&O.keys&&O.keys.IE_PROTO||"");return h?"Symbol(src)_1."+h:""})(),P=M.toString,L=w.hasOwnProperty,I=w.toString,T=RegExp("^"+P.call(L).replace(a,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),b=g.splice,k=en(o,"Map"),E=en(Object,"create");function U(h){var v=-1,_=h?h.length:0;for(this.clear();++v<_;){var W=h[v];this.set(W[0],W[1])}}function ue(){this.__data__=E?E(null):{}}function Z(h){return this.has(h)&&delete this.__data__[h]}function G(h){var v=this.__data__;if(E){var _=v[h];return _===t?void 0:_}return L.call(v,h)?v[h]:void 0}function te(h){var v=this.__data__;return E?v[h]!==void 0:L.call(v,h)}function q(h,v){var _=this.__data__;return _[h]=E&&v===void 0?t:v,this}U.prototype.clear=ue,U.prototype.delete=Z,U.prototype.get=G,U.prototype.has=te,U.prototype.set=q;function ne(h){var v=-1,_=h?h.length:0;for(this.clear();++v<_;){var W=h[v];this.set(W[0],W[1])}}function Me(){this.__data__=[]}function re(h){var v=this.__data__,_=xe(v,h);if(_<0)return!1;var W=v.length-1;return _==W?v.pop():b.call(v,_,1),!0}function Pe(h){var v=this.__data__,_=xe(v,h);return _<0?void 0:v[_][1]}function We(h){return xe(this.__data__,h)>-1}function Be(h,v){var _=this.__data__,W=xe(_,h);return W<0?_.push([h,v]):_[W][1]=v,this}ne.prototype.clear=Me,ne.prototype.delete=re,ne.prototype.get=Pe,ne.prototype.has=We,ne.prototype.set=Be;function H(h){var v=-1,_=h?h.length:0;for(this.clear();++v<_;){var W=h[v];this.set(W[0],W[1])}}function vt(){this.__data__={hash:new U,map:new(k||ne),string:new U}}function Bn(h){return Fe(this,h).delete(h)}function xn(h){return Fe(this,h).get(h)}function Fn(h){return Fe(this,h).has(h)}function $n(h,v){return Fe(this,h).set(h,v),this}H.prototype.clear=vt,H.prototype.delete=Bn,H.prototype.get=xn,H.prototype.has=Fn,H.prototype.set=$n;function xe(h,v){for(var _=h.length;_--;)if(Jn(h[_][0],v))return _;return-1}function zn(h){if(!tn(h)||qn(h))return!1;var v=Gn(h)||l(h)?T:s;return v.test(Hn(h))}function Fe(h,v){var _=h.__data__;return Nn(v)?_[typeof v=="string"?"string":"hash"]:_.map}function en(h,v){var _=d(h,v);return zn(_)?_:void 0}function Nn(h){var v=typeof h;return v=="string"||v=="number"||v=="symbol"||v=="boolean"?h!=="__proto__":h===null}function qn(h){return!!A&&A in h}function Hn(h){if(h!=null){try{return P.call(h)}catch{}try{return h+""}catch{}}return""}function yt(h,v){if(typeof h!="function"||v&&typeof v!="function")throw new TypeError(e);var _=function(){var W=arguments,gt=v?v.apply(this,W):W[0],mt=_.cache;if(mt.has(gt))return mt.get(gt);var nn=h.apply(this,W);return _.cache=mt.set(gt,nn),nn};return _.cache=new(yt.Cache||H),_}yt.Cache=H;function Jn(h,v){return h===v||h!==h&&v!==v}function Gn(h){var v=tn(h)?I.call(h):"";return v==n||v==r}function tn(h){var v=typeof h;return!!h&&(v=="object"||v=="function")}return _t=yt,_t}var ur=or();const cr=Vn(ur);function Ze(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function lr(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function On(e){let t,n,r;e.length!==2?(t=Ze,n=(u,o)=>Ze(e(u),o),r=(u,o)=>e(u)-o):(t=e===Ze||e===lr?e:hr,n=e,r=e);function a(u,o,d=0,l=u.length){if(d<l){if(t(o,o)!==0)return l;do{const g=d+l>>>1;n(u[g],o)<0?d=g+1:l=g}while(d<l)}return d}function s(u,o,d=0,l=u.length){if(d<l){if(t(o,o)!==0)return l;do{const g=d+l>>>1;n(u[g],o)<=0?d=g+1:l=g}while(d<l)}return d}function c(u,o,d=0,l=u.length){const g=a(u,o,d,l-1);return g>d&&r(u[g-1],o)>-r(u[g],o)?g-1:g}return{left:a,center:c,right:s}}function hr(){return 0}function dr(e){return e===null?NaN:+e}const fr=On(Ze),pr=fr.right;On(dr).center;function vr(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function ie(){var e=[.5],t=[0,1],n,r=1;function a(s){return s!=null&&s<=s?t[pr(e,s,0,r)]:n}return a.domain=function(s){return arguments.length?(e=Array.from(s),r=Math.min(e.length,t.length-1),a):e.slice()},a.range=function(s){return arguments.length?(t=Array.from(s),r=Math.min(e.length,t.length-1),a):t.slice()},a.invertExtent=function(s){var c=t.indexOf(s);return[e[c-1],e[c]]},a.unknown=function(s){return arguments.length?(n=s,a):n},a.copy=function(){return ie().domain(e).range(t).unknown(n)},vr.apply(a,arguments)}function Et(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function yr(e){if(Array.isArray(e))return e}function gr(e){if(Array.isArray(e))return Et(e)}function y(e,t,n){if(typeof e=="function"?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}function mr(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function dt(e,t,n){return t=de(t),Sr(e,Ln()?Reflect.construct(t,n||[],de(e).constructor):t.apply(e,n))}function Tn(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function z(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){return e.get(y(e,t))}function f(e,t,n){Tn(e,t),t.set(e,n)}function p(e,t,n){return e.set(y(e,t),n),n}function Ie(e,t){Tn(e,t),t.add(e)}function wr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Rn(r.key),r)}}function N(e,t,n){return t&&wr(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function m(e,t,n){return(t=Rn(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ut(){return Ut=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=Cn(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},Ut.apply(null,arguments)}function de(e){return de=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},de(e)}function ft(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Dt(e,t)}function Ln(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ln=function(){return!!e})()}function br(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function _r(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var r,a,s,c,u=[],o=!0,d=!1;try{if(s=(n=n.call(e)).next,t===0){if(Object(n)!==n)return;o=!1}else for(;!(o=(r=s.call(n)).done)&&(u.push(r.value),u.length!==t);o=!0);}catch(l){d=!0,a=l}finally{try{if(!o&&n.return!=null&&(c=n.return(),Object(c)!==c))return}finally{if(d)throw a}}return u}}function kr(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Mr(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function on(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function K(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?on(Object(n),!0).forEach(function(r){m(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):on(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function ae(e,t){if(e==null)return{};var n,r,a=Pr(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function Pr(e,t){if(e==null)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.indexOf(r)!==-1)continue;n[r]=e[r]}return n}function Sr(e,t){if(t&&(typeof t=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return mr(e)}function jt(e,t,n,r){return jt=typeof Reflect<"u"&&Reflect.set?Reflect.set:function(a,s,c,u){var o,d=Cn(a,s);if(d){if((o=Object.getOwnPropertyDescriptor(d,s)).set)return o.set.call(u,c),!0;if(!o.writable)return!1}if(o=Object.getOwnPropertyDescriptor(u,s)){if(!o.writable)return!1;o.value=c,Object.defineProperty(u,s,o)}else m(u,s,c);return!0},jt(e,t,n,r)}function Or(e,t,n,r,a){if(!jt(e,t,n,r||e)&&a)throw new TypeError("failed to set property");return n}function Dt(e,t){return Dt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},Dt(e,t)}function $(e,t){return yr(e)||_r(e,t)||An(e,t)||kr()}function Cn(e,t){for(;!{}.hasOwnProperty.call(e,t)&&(e=de(e))!==null;);return e}function Tr(e,t,n,r){var a=Ut(de(e.prototype),t,n);return 2&r&&typeof a=="function"?function(s){return a.apply(n,s)}:a}function j(e,t,n,r,a,s){return Or(de(e.prototype),t,n,r,a)}function se(e){return gr(e)||br(e)||An(e)||Mr()}function Lr(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function Rn(e){var t=Lr(e,"string");return typeof t=="symbol"?t:t+""}function An(e,t){if(e){if(typeof e=="string")return Et(e,t);var n={}.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Et(e,t):void 0}}var ze="https://speed.cloudflare.com",En={autoStart:!0,downloadApiUrl:"".concat(ze,"/__down"),uploadApiUrl:"".concat(ze,"/__up"),logMeasurementApiUrl:null,logAimApiUrl:"https://aim.cloudflare.com/__log",turnServerUri:"turn.speed.cloudflare.com:50000",turnServerCredsApiUrl:"".concat(ze,"/turn-creds"),turnServerUser:null,turnServerPass:null,rpkiInvalidHost:"invalid.rpki.cloudflare.com",cfTraceUrl:"".concat(ze,"/cdn-cgi/trace"),includeCredentials:!1,sessionId:void 0,measurements:[{type:"latency",numPackets:1},{type:"download",bytes:1e5,count:1,bypassMinDuration:!0},{type:"latency",numPackets:20},{type:"download",bytes:1e5,count:9},{type:"download",bytes:1e6,count:8},{type:"upload",bytes:1e5,count:8},{type:"packetLoss",numPackets:1e3,batchSize:10,batchWaitTime:10,responsesWaitTime:3e3},{type:"upload",bytes:1e6,count:6},{type:"download",bytes:1e7,count:6},{type:"upload",bytes:1e7,count:4},{type:"download",bytes:25e6,count:4},{type:"upload",bytes:25e6,count:4},{type:"download",bytes:1e8,count:3},{type:"upload",bytes:5e7,count:3},{type:"download",bytes:25e7,count:2}],measureDownloadLoadedLatency:!0,measureUploadLoadedLatency:!0,loadedLatencyThrottle:400,bandwidthFinishRequestDuration:1e3,estimatedServerTime:10,latencyPercentile:.5,bandwidthPercentile:.9,bandwidthMinRequestDuration:10,loadedRequestMinDuration:250,loadedLatencyMaxPoints:20},Un={aimMeasurementScoring:{packetLoss:ie([.01,.05,.25,.5],[10,5,0,-10,-20]),latency:ie([10,20,50,100,500],[20,10,5,0,-10,-20]),loadedLatencyIncrease:ie([10,20,50,100,500],[20,10,5,0,-10,-20]),jitter:ie([10,20,100,500],[10,5,0,-10,-20]),download:ie([1e6,1e7,5e7,1e8],[0,5,10,20,30]),upload:ie([1e6,1e7,5e7,1e8],[0,5,10,20,30])},aimExperiencesDefs:{streaming:{input:["latency","packetLoss","download","loadedLatencyIncrease"],pointThresholds:[15,20,40,60]},gaming:{input:["latency","packetLoss","loadedLatencyIncrease"],pointThresholds:[5,15,25,30]},rtc:{input:["latency","jitter","packetLoss","loadedLatencyIncrease"],pointThresholds:[5,15,25,40]}}},un=20,jn=.005,Cr=function(t){var n=t.headers.get("server-timing");if(n){var r=n.match(/dur=([0-9.]+)/);if(r)return+r[1]}},Rr=function(t){return t.responseStart-t.requestStart},Ar=function(t){return t.responseEnd-t.responseStart},Er=function(t){var n=t.ping,r=t.payloadDownloadTime;return n+r},Ur=function(t){var n=t.ttfb;return n},jr=function(t,n){var r=t.duration,a=t.transferSize,s=8*(a||+n*(1+jn)),c=r/1e3;return c?s/c:void 0},Dr=function(t,n){var r=t.duration,a=8*n*(1+jn),s=r/1e3;return s?a/s:void 0},Ir=cr(function(e){return"0".repeat(e)}),Ke=new WeakMap,Qe=new WeakMap,nt=new WeakMap,It=new WeakMap,Wt=new WeakMap,Bt=new WeakMap,rt=new WeakMap,xt=new WeakMap,we=new WeakMap,Ft=new WeakMap,$t=new WeakMap,Ue=new WeakMap,Re=new WeakMap,De=new WeakMap,ee=new WeakMap,ve=new WeakMap,Ae=new WeakMap,ye=new WeakMap,it=new WeakMap,zt=new WeakMap,Zt=new WeakMap,Nt=new WeakMap,X=new WeakSet,cn=(function(){function e(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=n.downloadApiUrl,a=n.uploadApiUrl,s=n.throttleMs,c=s===void 0?0:s,u=n.estimatedServerTime,o=u===void 0?0:u;if(z(this,e),Ie(this,X),f(this,Ke,{}),f(this,Qe,{}),m(this,"finishRequestDuration",1e3),m(this,"getServerTime",Cr),f(this,nt,function(d){return d}),f(this,It,function(){}),f(this,Wt,function(){}),f(this,Bt,function(){}),f(this,rt,function(){}),f(this,xt,function(){}),f(this,we,void 0),f(this,Ft,void 0),f(this,$t,void 0),f(this,Ue,!1),f(this,Re,{down:!1,up:!1}),f(this,De,{down:{},up:{}}),f(this,ee,0),f(this,ve,0),f(this,Ae,0),f(this,ye,-1/0),f(this,it,0),f(this,zt,0),f(this,Zt,void 0),f(this,Nt,void 0),!t)throw new Error("Missing measurements argument");if(!r)throw new Error("Missing downloadApiUrl argument");if(!a)throw new Error("Missing uploadApiUrl argument");p(we,this,t),p(Ft,this,r),p($t,this,a),p(it,this,c),p(zt,this,Math.max(0,o))}return N(e,[{key:"results",get:function(){return i(De,this)}},{key:"qsParams",get:function(){return i(Ke,this)},set:function(n){p(Ke,this,n)}},{key:"fetchOptions",get:function(){return i(Qe,this)},set:function(n){p(Qe,this,n)}},{key:"responseHook",set:function(n){p(nt,this,n)}},{key:"onRunningChange",set:function(n){p(It,this,n)}},{key:"onNewMeasurementStarted",set:function(n){p(Wt,this,n)}},{key:"onMeasurementResult",set:function(n){p(Bt,this,n)}},{key:"onFinished",set:function(n){p(rt,this,n)}},{key:"onConnectionError",set:function(n){p(xt,this,n)}},{key:"pause",value:function(){clearTimeout(i(Nt,this)),y(X,this,Wr).call(this),y(X,this,at).call(this,!1)}},{key:"play",value:function(){i(Ue,this)||(y(X,this,at).call(this,!0),y(X,this,Ye).call(this))}}])})();function at(e){var t=this;e!==i(Ue,this)&&(p(Ue,this,e),setTimeout(function(){return i(It,t).call(t,i(Ue,t))}))}function ln(e,t){var n=this,r=i(we,this)[e],a=r.bytes,s=r.dir,c=i(De,this),u=c[s].hasOwnProperty(a)?c[s][a]:{timings:[],numMeasurements:i(we,this).filter(function(o){var d=o.bytes,l=o.dir;return a===d&&s===l}).map(function(o){return o.count}).reduce(function(o,d){return o+d},0)};t&&u.timings.push(t),u.timings=u.timings.slice(-u.numMeasurements),c[s][a]=u,t?setTimeout(function(){i(Bt,n).call(n,K({type:s,bytes:a},t),c)}):i(Wt,this).call(this,i(we,this)[e],c)}function Ye(){var e=this,t=i(we,this),n=t[i(ee,this)];if(i(ve,this)>=n.count){var r=i(Re,this);if(i(ye,this)>this.finishRequestDuration&&!n.bypassMinDuration){var a=n.dir;i(Re,this)[a]=!0,Object.values(i(Re,this)).every(function(P){return P})&&i(rt,this).call(this,i(De,this))}p(ve,this,0),p(ye,this,-1/0),performance.clearResourceTimings();do p(ee,this,i(ee,this)+1);while(i(ee,this)<t.length&&r[t[i(ee,this)].dir]);if(i(ee,this)>=t.length){p(Re,this,{down:!0,up:!0}),y(X,this,at).call(this,!1),i(rt,this).call(this,i(De,this));return}n=t[i(ee,this)]}var s=i(ee,this);i(ve,this)===0&&y(X,this,ln).call(this,s);var c=n,u=c.bytes,o=c.dir,d=o==="down",l=d?i(Ft,this):i($t,this),g=Object.assign({},i(Ke,this));d&&(g.bytes="".concat(u));var M="".concat(l.startsWith("http")||l.startsWith("//")?"":window.location.origin).concat(l,"?").concat(Object.entries(g).map(function(P){var L=$(P,2),I=L[0],T=L[1];return"".concat(I,"=").concat(T)}).join("&")),w=Object.assign({},d?{}:{method:"POST",body:Ir(u)},i(Qe,this)),O,A=p(Zt,this,fetch(M,w).then(function(P){if(P.ok)return P;throw Error(P.statusText)}).then(function(P){return e.getServerTime&&(O=e.getServerTime(P)),P}).then(function(P){return P.text().then(function(L){return i(nt,e)&&i(nt,e).call(e,{url:M,headers:P.headers,body:L}),L})}).then(function(P,L){if(A._cancel){L("cancelled");return}var I=performance.getEntriesByName(M).slice(-1)[0],T={transferSize:I.transferSize,ttfb:Rr(I),payloadDownloadTime:Ar(I),serverTime:O||-1,measTime:new Date};if(T.ping=Math.max(.01,T.ttfb-(O||i(zt,e))),T.duration=(d?Er:Ur)(T),T.bps=(d?jr:Dr)(T,u),d&&u){var b=+u;T.transferSize&&(T.transferSize<b||T.transferSize/b>1.05)&&console.warn("Requested ".concat(b,"B but received ").concat(T.transferSize,"B (").concat(Math.round(T.transferSize/b*1e4)/100,"%)."))}y(X,e,ln).call(e,s,T);var k=T.duration;p(ye,e,i(ye,e)<0?k:Math.min(i(ye,e),k)),p(ve,e,i(ve,e)+1),p(Ae,e,0),i(it,e)?p(Nt,e,setTimeout(function(){return y(X,e,Ye).call(e)},i(it,e))):y(X,e,Ye).call(e)}).catch(function(P){var L,I;A._cancel||(console.warn("Error fetching ".concat(M,": ").concat(P)),p(Ae,e,(L=i(Ae,e),I=L++,L)),I<un?y(X,e,Ye).call(e):(p(Ae,e,0),y(X,e,at).call(e,!1),i(xt,e).call(e,"Connection failed to ".concat(M,". Gave up after ").concat(un," retries."))))}))}function Wr(){var e=i(Zt,this);e&&(e._cancel=!0)}var Br=["measureParallelLatency","parallelLatencyThrottleMs","downloadApiUrl","uploadApiUrl","estimatedServerTime"],x=new WeakMap,qt=new WeakMap,kt=new WeakSet,xr=(function(e){function t(n){var r,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=a.measureParallelLatency,c=s===void 0?!1:s,u=a.parallelLatencyThrottleMs,o=u===void 0?100:u,d=a.downloadApiUrl,l=a.uploadApiUrl,g=a.estimatedServerTime,M=g===void 0?0:g,w=ae(a,Br);return z(this,t),r=dt(this,t,[n,K({downloadApiUrl:d,uploadApiUrl:l,estimatedServerTime:M},w)]),Ie(r,kt),f(r,x,void 0),f(r,qt,void 0),c&&(p(x,r,new cn([{dir:"down",bytes:0,count:1/0,bypassMinDuration:!0}],{downloadApiUrl:d,uploadApiUrl:l,estimatedServerTime:M,throttleMs:o})),i(x,r).qsParams={during:"".concat(n[0].dir,"load")},j(t,"onRunningChange",y(kt,r,hn),r,1),j(t,"onConnectionError",function(){return i(x,r).pause()},r,1)),r}return ft(t,e),N(t,[{key:"latencyResults",get:function(){return i(x,this)&&i(x,this).results.down[0].timings}},{key:"onParallelLatencyResult",set:function(r){i(x,this)&&(i(x,this).onMeasurementResult=function(a){return r(a)})}},{key:"fetchOptions",get:function(){return Tr(t,"fetchOptions",this,1)},set:function(r){j(t,"fetchOptions",r,this,1),i(x,this)&&(i(x,this).fetchOptions=r)}},{key:"onRunningChange",set:function(r){var a=this;j(t,"onRunningChange",function(s){y(kt,a,hn).call(a,s),r(s)},this,1)}},{key:"onConnectionError",set:function(r){var a=this;j(t,"onConnectionError",function(){i(x,a)&&i(x,a).pause(),r.apply(void 0,arguments)},this,1)}}])})(cn);function hn(e){var t=this;i(x,this)&&(e?p(qt,this,setTimeout(function(){return i(x,t).play()},20)):(clearTimeout(i(qt,this)),i(x,this).pause()))}var Fr=["measurementId","logApiUrl","sessionId"],Ee=new WeakMap,st=new WeakMap,ot=new WeakMap,be=new WeakMap,Ht=new WeakMap,Se=new WeakSet,dn=(function(e){function t(n){var r,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=a.measurementId,c=a.logApiUrl,u=a.sessionId,o=ae(a,Fr);return z(this,t),r=dt(this,t,[n,o]),Ie(r,Se),f(r,Ee,void 0),f(r,st,void 0),f(r,ot,void 0),f(r,be,void 0),f(r,Ht,void 0),p(Ee,r,s),p(be,r,c),p(Ht,r,u),j(t,"qsParams",c?{measId:i(Ee,r)}:{},r,1),j(t,"responseHook",function(d){return y(Se,r,fn).call(r,d)},r,1),j(t,"onMeasurementResult",function(d){return y(Se,r,pn).call(r,d)},r,1),r}return ft(t,e),N(t,[{key:"qsParams",set:function(r){j(t,"qsParams",i(be,this)?K({measId:i(Ee,this)},r):r,this,1)}},{key:"responseHook",set:function(r){var a=this;j(t,"responseHook",function(s){r(s),y(Se,a,fn).call(a,s)},this,1)}},{key:"onMeasurementResult",set:function(r){var a=this;j(t,"onMeasurementResult",function(s){for(var c=arguments.length,u=new Array(c>1?c-1:0),o=1;o<c;o++)u[o-1]=arguments[o];r.apply(void 0,[s].concat(u)),y(Se,a,pn).call(a,s)},this,1)}}])})(xr);function fn(e){i(be,this)&&(p(ot,this,+e.headers.get("cf-meta-request-time")),p(st,this,e.body.slice(-300).split("___").pop()))}function pn(e){if(i(be,this)){var t={type:e.type,bytes:e.bytes,ping:Math.round(e.ping),ttfb:Math.round(e.ttfb),payloadDownloadTime:Math.round(e.payloadDownloadTime),duration:Math.round(e.duration),transferSize:Math.round(e.transferSize),serverTime:Math.round(e.serverTime),token:i(st,this),requestTime:i(ot,this),measId:i(Ee,this),sessionId:i(Ht,this)};p(st,this,null),p(ot,this,null),fetch(i(be,this),K({method:"POST",body:JSON.stringify(t)},this.fetchOptions))}}var ut=new WeakMap,Kt=new WeakMap,Jt=new WeakMap,ge=new WeakSet,$r=(function(){function e(t){if(z(this,e),Ie(this,ge),f(this,ut,!1),f(this,Kt,void 0),f(this,Jt,void 0),!t)throw new Error("Missing operation to perform");p(Jt,this,t),this.play()}return N(e,[{key:"pause",value:function(){y(ge,this,zr).call(this),y(ge,this,vn).call(this,!1)}},{key:"stop",value:function(){this.pause()}},{key:"play",value:function(){i(ut,this)||(y(ge,this,vn).call(this,!0),y(ge,this,Dn).call(this))}}])})();function vn(e){e!==i(ut,this)&&p(ut,this,e)}function Dn(){var e=this,t=p(Kt,this,i(Jt,this).call(this).then(function(){!t._cancel&&y(ge,e,Dn).call(e)}))}function zr(){var e=i(Kt,this);e&&(e._cancel=!0)}var Oe=new WeakMap,Nr=(function(){function e(){var t=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=n.download,a=n.upload;if(z(this,e),m(this,"qsParams",{}),m(this,"fetchOptions",{}),f(this,Oe,[]),!r&&!a)throw new Error("Missing at least one of download/upload config");[[r,"download"],[a,"upload"]].filter(function(c){var u=$(c,1),o=u[0];return o}).forEach(function(c){var u=$(c,2),o=u[0],d=u[1],l=o.apiUrl,g=o.chunkSize;if(!l)throw new Error("Missing ".concat(d," apiUrl argument"));if(!g)throw new Error("Missing ".concat(d," chunkSize argument"))});var s=function(u){var o=u.apiUrl,d=u.qsParams,l=d===void 0?{}:d,g=u.fetchOptions,M=g===void 0?{}:g;return new $r(function(){var w=Object.assign({},l,t.qsParams),O="".concat(o.startsWith("http")||o.startsWith("//")?"":window.location.origin).concat(o,"?").concat(Object.entries(w).map(function(P){var L=$(P,2),I=L[0],T=L[1];return"".concat(I,"=").concat(T)}).join("&")),A=Object.assign({},M,t.fetchOptions);return fetch(O,A).then(function(P){if(P.ok)return P;throw Error(P.statusText)}).then(function(P){return P.text()})})};r&&i(Oe,this).push(s({apiUrl:r.apiUrl,qsParams:{bytes:"".concat(r.chunkSize)}})),a&&i(Oe,this).push(s({apiUrl:a.apiUrl,fetchOptions:{method:"POST",body:"0".repeat(a.chunkSize)}}))}return N(e,[{key:"pause",value:function(){i(Oe,this).forEach(function(n){return n.pause()})}},{key:"stop",value:function(){this.pause()}},{key:"play",value:function(){i(Oe,this).forEach(function(n){return n.play()})}}])})(),qr=["iceServers","acceptIceCandidate","dataChannelCfg"],Te=new WeakMap,Ne=new WeakMap,qe=new WeakMap,Le=new WeakMap,He=new WeakMap,Hr=(function(){function e(){var t=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=n.iceServers,a=r===void 0?[]:r,s=n.acceptIceCandidate,c=s===void 0?function(w){var O=w.protocol||"";if(!O&&w.candidate){var A=w.candidate.split(" ");A.length>=3&&(O=A[2])}return O.toLowerCase()==="udp"}:s,u=n.dataChannelCfg,o=u===void 0?{ordered:!1,maxRetransmits:0}:u,d=ae(n,qr);z(this,e),m(this,"onOpen",function(){}),m(this,"onClose",function(){}),m(this,"onMessageReceived",function(){}),f(this,Te,!1),f(this,Ne,void 0),f(this,qe,void 0),f(this,Le,void 0),f(this,He,void 0);var l=new RTCPeerConnection(K({iceServers:a},d)),g=new RTCPeerConnection(K({iceServers:a},d)),M=l.createDataChannel("channel",o);M.onopen=function(){p(Te,t,!0),t.onOpen()},M.onclose=function(){return t.close()},g.ondatachannel=function(w){var O=w.channel;O.onclose=function(){return t.close()},O.onmessage=function(A){return t.onMessageReceived(A.data)},p(He,t,O)},l.onicecandidate=function(w){w.candidate&&c(w.candidate)&&g.addIceCandidate(w.candidate)},g.onicecandidate=function(w){w.candidate&&c(w.candidate)&&l.addIceCandidate(w.candidate)},l.createOffer().then(function(w){return l.setLocalDescription(w)}).then(function(){return g.setRemoteDescription(l.localDescription)}).then(function(){return g.createAnswer()}).then(function(w){return g.setLocalDescription(w)}).then(function(){return l.setRemoteDescription(g.localDescription)}),p(Ne,this,l),p(qe,this,g),p(Le,this,M),p(Te,this,!1)}return N(e,[{key:"send",value:function(n){return i(Le,this).send(n)}},{key:"close",value:function(){return i(Ne,this)&&i(Ne,this).close(),i(qe,this)&&i(qe,this).close(),i(Le,this)&&i(Le,this).close(),i(He,this)&&i(He,this).close(),i(Te,this)&&this.onClose(),p(Te,this,!1),this}}])})(),Mt=new WeakMap,Je=new WeakMap,Pt=new WeakMap,fe=new WeakMap,yn=new WeakMap,St=new WeakMap,Jr=(function(){function e(){var t=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=n.turnServerUri,a=n.turnServerCredsApi,s=n.turnServerCredsApiParser,c=s===void 0?function(k){var E=k.username,U=k.credential,ue=k.server;return{turnServerUser:E,turnServerPass:U,turnServerUri:ue}}:s,u=n.turnServerCredsApiIncludeCredentials,o=u===void 0?!1:u,d=n.turnServerUser,l=n.turnServerPass,g=n.numMsgs,M=g===void 0?100:g,w=n.batchSize,O=w===void 0?10:w,A=n.batchWaitTime,P=A===void 0?10:A,L=n.responsesWaitTime,I=L===void 0?5e3:L,T=n.connectionTimeout,b=T===void 0?5e3:T;if(z(this,e),f(this,Mt,function(){}),f(this,Je,function(){}),f(this,Pt,function(){}),m(this,"onMsgSent",function(){}),m(this,"onAllMsgsSent",function(){}),m(this,"onMsgReceived",function(){}),f(this,fe,{}),f(this,yn,void 0),f(this,St,void 0),!r&&!a)throw new Error("Missing turnServerCredsApi or turnServerUri argument");if((!d||!l)&&!a)throw new Error("Missing either turnServerCredsApi or turnServerUser+turnServerPass arguments");p(St,this,M),(!d||!l?fetch(a,{credentials:o?"include":void 0}).then(function(k){return k.json()}).then(function(k){if(k.error)throw k.error;return k}).then(c):Promise.resolve({turnServerUser:d,turnServerPass:l})).catch(function(k){return i(Mt,t).call(t,k)}).then(function(k){var E=k.turnServerUser,U=k.turnServerPass,ue=k.turnServerUri,Z=p(yn,t,new Hr({iceServers:[{urls:"turn:".concat(ue||r,"?transport=udp"),username:E,credential:U}],iceTransportPolicy:"relay"})),G=!1;setTimeout(function(){G||(Z.close(),i(Je,t).call(t,"ICE connection timeout!"))},b);var te=i(fe,t);Z.onOpen=function(){G=!0;var q=t;(function ne(Me){if(Me<=M){for(var re=Me;re<=Math.min(M,Me+O-1);)te[re]=!1,Z.send(re),q.onMsgSent(re),re++;setTimeout(function(){return ne(re)},P)}else{q.onAllMsgsSent(Object.keys(te).length);var Pe=function(){Z.close(),i(Pt,q).call(q,q.results)},We=setTimeout(Pe,I),Be=Object.values(i(fe,q)).filter(function(H){return!H}).length;Z.onMessageReceived=function(H){clearTimeout(We),te[H]=!0,q.onMsgReceived(H),Be--,Be<=0&&Object.values(i(fe,q)).every(function(vt){return vt})?Pe():We=setTimeout(Pe,I)}}})(1)},Z.onMessageReceived=function(q){te[q]=!0,t.onMsgReceived(q)}}).catch(function(k){return i(Je,t).call(t,k.toString())})}return N(e,[{key:"onCredentialsFailure",set:function(n){p(Mt,this,n)}},{key:"onConnectionError",set:function(n){p(Je,this,n)}},{key:"onFinished",set:function(n){p(Pt,this,n)}},{key:"results",get:function(){var n=i(St,this),r=Object.keys(i(fe,this)).length,a=Object.entries(i(fe,this)).filter(function(c){var u=$(c,2),o=u[1];return!o}).map(function(c){var u=$(c,1),o=u[0];return+o}),s=a.length/r;return{totalMessages:n,numMessagesSent:r,packetLoss:s,lostMessages:a}}}])})(),Gr=["downloadChunkSize","uploadChunkSize","downloadApiUrl","uploadApiUrl"],J=new WeakMap,Vr=(function(e){function t(){var n,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=r.downloadChunkSize,s=r.uploadChunkSize,c=r.downloadApiUrl,u=r.uploadApiUrl,o=ae(r,Gr);return z(this,t),n=dt(this,t,[o]),f(n,J,void 0),(a||s)&&(p(J,n,new Nr({download:a?{apiUrl:c,chunkSize:a}:null,upload:s?{apiUrl:u,chunkSize:s}:null})),j(t,"onCredentialsFailure",j(t,"onConnectionError",j(t,"onFinished",function(){return i(J,n).stop()},n,1,1),n,1,1),n,1)),n}return ft(t,e),N(t,[{key:"qsParams",set:function(r){i(J,this)&&(i(J,this).qsParams=r)}},{key:"fetchOptions",set:function(r){i(J,this)&&(i(J,this).fetchOptions=r)}},{key:"onCredentialsFailure",set:function(r){var a=this;j(t,"onCredentialsFailure",function(){r.apply(void 0,arguments),i(J,a)&&i(J,a).stop()},this,1)}},{key:"onConnectionError",set:function(r){var a=this;j(t,"onConnectionError",function(){r.apply(void 0,arguments),i(J,a)&&i(J,a).stop()},this,1)}},{key:"onFinished",set:function(r){var a=this;j(t,"onFinished",function(){r.apply(void 0,arguments),i(J,a)&&i(J,a).stop()},this,1)}}])})(Jr),Xr=["reachable"],Ot=N(function e(t){var n=this,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=r.timeout,s=a===void 0?-1:a,c=r.fetchOptions,u=c===void 0?{}:c;z(this,e),m(this,"onFinished",function(){});var o=!1,d=function(g){var M=g.reachable,w=ae(g,Xr);o||(o=!0,n.onFinished(K({targetUrl:t,reachable:M},w)))};fetch(t,u).then(function(l){d({reachable:!0,response:l})}).catch(function(l){d({reachable:!1,error:l})}),s>0&&setTimeout(function(){return d({reachable:!1,error:"Request timeout"})},s)}),Zr=function(t){return t.reduce(function(n,r){return n+r},0)},gn=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.5;if(!t.length)return 0;var r=t.slice().sort(function(u,o){return u-o}),a=(t.length-1)*n,s=a%1;if(s===0)return r[Math.round(a)];var c=[Math.floor,Math.ceil].map(function(u){return r[u(a)]});return c[0]+(c[1]-c[0])*s},ce=new WeakMap,Ge=new WeakMap,Kr=(function(){function e(t){var n=this;z(this,e),m(this,"getLatencyPoints",function(r){return r.timings.map(function(a){return a.ping})}),m(this,"getLatency",function(r){return gn(n.getLatencyPoints(r),i(ce,n).latencyPercentile)}),m(this,"getBandwidthPoints",function(r){return Object.entries(r).map(function(a){var s=$(a,2),c=s[0],u=s[1].timings;return u.map(function(o){var d=o.bps,l=o.duration,g=o.ping,M=o.measTime,w=o.serverTime,O=o.transferSize;return{bytes:+c,bps:d,duration:l,ping:g,measTime:M,serverTime:w,transferSize:O}})}).flat()}),m(this,"getBandwidth",function(r){return gn(n.getBandwidthPoints(r).filter(function(a){return a.duration>=i(ce,n).bandwidthMinRequestDuration}).map(function(a){return a.bps}).filter(function(a){return a}),i(ce,n).bandwidthPercentile)}),m(this,"getLoadedLatency",function(r){return n.getLatency({timings:i(Ge,n).call(n,r)})}),m(this,"getLoadedJitter",function(r){return n.getJitter({timings:i(Ge,n).call(n,r)})}),m(this,"getLoadedLatencyPoints",function(r){return n.getLatencyPoints({timings:i(Ge,n).call(n,r)})}),m(this,"getPacketLoss",function(r){return r.packetLoss}),m(this,"getPacketLossDetails",function(r){return r}),m(this,"getReachability",function(r){return!!r.reachable}),m(this,"getReachabilityDetails",function(r){return{host:r.host,reachable:r.reachable}}),f(this,ce,void 0),f(this,Ge,function(r){return Object.values(r).filter(function(a){return a.timings.length&&Math.min.apply(Math,se(a.timings.map(function(s){return s.duration})))>=i(ce,n).loadedRequestMinDuration}).map(function(a){return a.sideLatency||[]}).flat().slice(-i(ce,n).loadedLatencyMaxPoints)}),p(ce,this,t)}return N(e,[{key:"getJitter",value:function(n){var r=this.getLatencyPoints(n);return r.length<2?null:r.reduce(function(a,s){var c=a.sumDeltas,u=c===void 0?0:c,o=a.prevLatency;return{sumDeltas:u+(o!==void 0?Math.abs(o-s):0),prevLatency:s}},{}).sumDeltas/(r.length-1)}}])})(),Qr=["bad","poor","average","good","great"],mn={loadedLatencyIncrease:function(t){return t.latency&&(t.downLoadedLatency||t.upLoadedLatency)?Math.max(t.downLoadedLatency,t.upLoadedLatency)-t.latency:void 0}},wn={packetLoss:0},Ve=new WeakMap,Yr=(function(){function e(t){z(this,e),f(this,Ve,void 0),p(Ve,this,t)}return N(e,[{key:"getScores",value:function(n){var r=Object.assign.apply(Object,se(Object.entries(i(Ve,this).aimMeasurementScoring).map(function(a){var s=$(a,2),c=s[0],u=s[1],o=mn.hasOwnProperty(c)?mn[c](n):n[c];return o===void 0?wn.hasOwnProperty(c)?m({},c,wn[c]):{}:m({},c,o===void 0?0:+u(o))})));return Object.assign.apply(Object,[{}].concat(se(Object.entries(i(Ve,this).aimExperiencesDefs).filter(function(a){var s=$(a,2),c=s[1].input;return c.every(function(u){return r.hasOwnProperty(u)})}).map(function(a){var s=$(a,2),c=s[0],u=s[1],o=u.input,d=u.pointThresholds,l=Math.max(0,Zr(o.map(function(w){return r[w]}))),g=ie(d,[0,1,2,3,4])(l),M=Qr[g];return m({},c,{points:l,classificationIdx:g,classificationName:M})}))))}}])})(),Ce=new WeakMap,Tt=new WeakMap,Lt=new WeakMap,R=new WeakMap,bn=new WeakMap,ei=new WeakMap,_n=new WeakMap,ti=new WeakMap,ni=(function(){function e(t){var n=this;z(this,e),m(this,"raw",void 0),m(this,"getUnloadedLatency",function(){return i(R,n).call(n,"getLatency","latency")}),m(this,"getUnloadedJitter",function(){return i(R,n).call(n,"getJitter","latency")}),m(this,"getUnloadedLatencyPoints",function(){return i(R,n).call(n,"getLatencyPoints","latency",[])}),m(this,"getDownLoadedLatency",function(){return i(R,n).call(n,"getLoadedLatency","download")}),m(this,"getDownLoadedJitter",function(){return i(R,n).call(n,"getLoadedJitter","download")}),m(this,"getDownLoadedLatencyPoints",function(){return i(R,n).call(n,"getLoadedLatencyPoints","download",[])}),m(this,"getUpLoadedLatency",function(){return i(R,n).call(n,"getLoadedLatency","upload")}),m(this,"getUpLoadedJitter",function(){return i(R,n).call(n,"getLoadedJitter","upload")}),m(this,"getUpLoadedLatencyPoints",function(){return i(R,n).call(n,"getLoadedLatencyPoints","upload",[])}),m(this,"getDownloadBandwidth",function(){return i(R,n).call(n,"getBandwidth","download")}),m(this,"getDownloadBandwidthPoints",function(){return i(R,n).call(n,"getBandwidthPoints","download",[])}),m(this,"getUploadBandwidth",function(){return i(R,n).call(n,"getBandwidth","upload")}),m(this,"getUploadBandwidthPoints",function(){return i(R,n).call(n,"getBandwidthPoints","upload",[])}),m(this,"getPacketLoss",function(){return i(R,n).call(n,"getPacketLoss","packetLoss")}),m(this,"getPacketLossDetails",function(){return i(R,n).call(n,"getPacketLossDetails","packetLoss",void 0,!0)}),m(this,"getScores",function(){return i(Lt,n).getScores(n.getSummary())}),f(this,Ce,void 0),f(this,Tt,void 0),f(this,Lt,void 0),f(this,R,function(r,a){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,c=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return!n.raw.hasOwnProperty(a)||!n.raw[a].started?s:c&&n.raw[a].error?{error:n.raw[a].error}:i(Tt,n)[r](n.raw[a].results)}),f(this,bn,function(){return i(R,n).call(n,"getReachability","v4Reachability")}),f(this,ei,function(){return i(R,n).call(n,"getReachabilityDetails","v4Reachability")}),f(this,_n,function(){return i(R,n).call(n,"getReachability","v6Reachability")}),f(this,ti,function(){return i(R,n).call(n,"getReachabilityDetails","v6Reachability")}),p(Ce,this,t),this.clear(),p(Tt,this,new Kr(i(Ce,this))),p(Lt,this,new Yr(i(Ce,this)))}return N(e,[{key:"isFinished",get:function(){return Object.values(this.raw).every(function(n){return n.finished})}},{key:"clear",value:function(){this.raw=Object.assign.apply(Object,[{}].concat(se(se(new Set(i(Ce,this).measurements.map(function(n){return n.type}))).map(function(n){return m({},n,{started:!1,finished:!1,results:{}})}))))}},{key:"getSummary",value:function(){var n={download:this.getDownloadBandwidth,upload:this.getUploadBandwidth,latency:this.getUnloadedLatency,jitter:this.getUnloadedJitter,downLoadedLatency:this.getDownLoadedLatency,downLoadedJitter:this.getDownLoadedJitter,upLoadedLatency:this.getUpLoadedLatency,upLoadedJitter:this.getUpLoadedJitter,packetLoss:this.getPacketLoss,v4Reachability:i(bn,this),v6Reachability:i(_n,this)};return Object.assign.apply(Object,se(Object.entries(n).map(function(r){var a=$(r,2),s=a[0],c=a[1],u=c();return u===void 0?{}:m({},s,u)})))}}])})(),Qt=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return t&&Math.round(t*Math.pow(10,n))/Math.pow(10,n)},Ct=function(t){return t.map(function(n){return Qt(n,2)})},kn=function(t){return t.map(function(n){return{bytes:+n.bytes,bps:Qt(n.bps)}})},ri=function(t){return t.error?void 0:{numMessages:t.numMessagesSent,lossRatio:Qt(t.packetLoss,4)}},ii={latencyMs:["getUnloadedLatencyPoints",Ct],download:["getDownloadBandwidthPoints",kn],upload:["getUploadBandwidthPoints",kn],downLoadedLatencyMs:["getDownLoadedLatencyPoints",Ct],upLoadedLatencyMs:["getUpLoadedLatencyPoints",Ct],packetLoss:["getPacketLossDetails",ri]},ai=function(t){return{points:t.points,classification:t.classificationName}},si=function(t,n){var r=n.apiUrl,a=n.sessionId,s={sessionId:a};Object.entries(ii).forEach(function(u){var o=$(u,2),d=o[0],l=$(o[1],2),g=l[0],M=l[1],w=M===void 0?function(A){return A}:M,O=t[g]();O&&(s[d]=w(O))});var c=t.getScores();c&&(s.scores=Object.assign.apply(Object,[{}].concat(se(Object.entries(c).map(function(u){var o=$(u,2),d=o[0],l=o[1];return m({},d,ai(l))}))))),fetch(r,{method:"POST",body:JSON.stringify(s)})},oi=["type"],ui=["numPackets"],ci=["bytes"],li=1e6,hi=1e6,di=.5,Yt=["latency","latencyUnderLoad","download","upload"],In=function(){return"".concat(Math.round(Math.random()*1e16))},Gt=new WeakMap,me=new WeakMap,C=new WeakMap,je=new WeakMap,ct=new WeakMap,Q=new WeakMap,_e=new WeakMap,et=new WeakMap,tt=new WeakMap,oe=new WeakMap,lt=new WeakMap,S=new WeakSet,fi=(function(){function e(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};z(this,e),Ie(this,S),m(this,"onRunningChange",function(){}),m(this,"onResultsChange",function(){}),f(this,Gt,function(){}),f(this,me,function(){}),f(this,C,void 0),f(this,je,void 0),f(this,ct,In()),f(this,Q,-1),f(this,_e,void 0),f(this,et,li),f(this,tt,hi),f(this,oe,!1),f(this,lt,!1),p(C,this,Object.assign({},En,t,Un)),p(je,this,new ni(i(C,this))),i(C,this).autoStart&&this.play()}return N(e,[{key:"results",get:function(){return i(je,this)}},{key:"isRunning",get:function(){return i(oe,this)}},{key:"isFinished",get:function(){return i(lt,this)}},{key:"onFinish",set:function(n){p(Gt,this,n)}},{key:"onError",set:function(n){p(me,this,n)}},{key:"pause",value:function(){Yt.includes(y(S,this,pt).call(this))&&i(_e,this).pause(),y(S,this,ht).call(this,!1)}},{key:"play",value:function(){i(oe,this)||(y(S,this,ht).call(this,!0),y(S,this,V).call(this))}},{key:"restart",value:function(){y(S,this,pi).call(this),this.play()}}])})();function ht(e){e!==i(oe,this)&&(p(oe,this,e),this.onRunningChange(i(oe,this)))}function Wn(e){var t=this;e!==i(lt,this)&&(p(lt,this,e),e&&setTimeout(function(){return i(Gt,t).call(t,t.results)}))}function pt(){return i(Q,this)<0||i(Q,this)>=i(C,this).measurements.length?null:i(C,this).measurements[i(Q,this)].type}function pe(){return i(je,this).raw[y(S,this,pt).call(this)]||void 0}function pi(){y(S,this,vi).call(this),p(ct,this,In()),p(Q,this,-1),p(_e,this,void 0),y(S,this,ht).call(this,!1),y(S,this,Wn).call(this,!1),i(je,this).clear()}function vi(){var e=i(_e,this);e&&(e.onFinished=e.onConnectionError=e.onFail=e.onMsgReceived=e.onCredentialsFailure=e.onMeasurementResult=function(){},Yt.includes(y(S,this,pt).call(this))&&e.pause())}function V(){var e=this,t;if(Yt.includes(y(S,this,pt).call(this))&&y(S,this,pe).call(this)&&y(S,this,pe).call(this).started&&!y(S,this,pe).call(this).finished&&!y(S,this,pe).call(this).finishedCurrentRound&&!y(S,this,pe).call(this).error){i(_e,this).play();return}if(p(Q,this,(t=i(Q,this),t++,t)),i(Q,this)>=i(C,this).measurements.length){y(S,this,ht).call(this,!1),y(S,this,Wn).call(this,!0);return}var n=i(C,this).measurements[i(Q,this)],r=n.type,a=ae(n,oi),s=y(S,this,pe).call(this),c=i(C,this),u=c.downloadApiUrl,o=c.uploadApiUrl,d=c.estimatedServerTime,l;switch(r){case"v4Reachability":case"v6Reachability":l=new Ot("https://".concat(a.host),{fetchOptions:{method:"GET",mode:"no-cors"}}),l.onFinished=function(b){s.finished=!0,s.results=K({host:a.host},b),e.onResultsChange({type:r}),y(S,e,V).call(e)};break;case"rpki":l=new Ot("https://".concat(i(C,this).rpkiInvalidHost),{timeout:5e3}),l.onFinished=function(b){(b.response?b.response.json():Promise.resolve()).then(function(k){s.finished=!0,s.results=K({host:i(C,e).rpkiInvalidHost,filteringInvalids:!b.reachable},k?{asn:k.asn,name:k.name}:{}),e.onResultsChange({type:r}),y(S,e,V).call(e)})};break;case"nxdomain":l=new Ot("https://".concat(a.nxhost),{fetchOptions:{mode:"no-cors"}}),l.onFinished=function(b){s.finished=!0,s.results={host:a.nxhost,reachable:b.reachable},e.onResultsChange({type:r}),y(S,e,V).call(e)};break;case"packetLoss":case"packetLossUnderLoad":{s.finished=!1;var g=a.numPackets,M=ae(a,ui),w=i(C,this),O=w.turnServerUri,A=w.turnServerCredsApiUrl,P=w.turnServerUser,L=w.turnServerPass,I=w.includeCredentials;l=new Vr(K({turnServerUri:O,turnServerCredsApi:A,turnServerCredsApiIncludeCredentials:I,turnServerUser:P,turnServerPass:L,numMsgs:g,downloadChunkSize:a.loadDown?i(et,this):void 0,uploadChunkSize:a.loadUp?i(tt,this):void 0,downloadApiUrl:u,uploadApiUrl:o},M))}l.onMsgReceived=function(){s.results=Object.assign({},l.results),e.onResultsChange({type:r})},l.onFinished=function(){s.finished=!0,e.onResultsChange({type:r}),y(S,e,V).call(e)},l.onConnectionError=function(b){s.error=b,e.onResultsChange({type:r}),i(me,e).call(e,"Connection error while measuring packet loss: ".concat(b)),y(S,e,V).call(e)},l.onCredentialsFailure=function(){s.error="unable to get turn server credentials",e.onResultsChange({type:r}),i(me,e).call(e,"Error while measuring packet loss: unable to get turn server credentials."),y(S,e,V).call(e)};break;case"latency":case"latencyUnderLoad":s.finished=!1,l=new dn([{dir:"down",bytes:0,count:a.numPackets,bypassMinDuration:!0}],{downloadApiUrl:u,uploadApiUrl:o,estimatedServerTime:d,logApiUrl:i(C,this).logMeasurementApiUrl,measurementId:i(ct,this),sessionId:i(C,this).sessionId,downloadChunkSize:a.loadDown?i(et,this):void 0,uploadChunkSize:a.loadUp?i(tt,this):void 0}),l.fetchOptions={credentials:i(C,this).includeCredentials?"include":void 0},l.onMeasurementResult=l.onNewMeasurementStarted=function(b,k){s.results=Object.assign({},k.down[0]),e.onResultsChange({type:r})},l.onFinished=function(){s.finished=!0,e.onResultsChange({type:r}),i(oe,e)&&y(S,e,V).call(e)},l.onConnectionError=function(b){s.error=b,e.onResultsChange({type:r}),i(me,e).call(e,"Connection error while measuring latency: ".concat(b)),y(S,e,V).call(e)},l.play();break;case"download":case"upload":if(s.finished||s.error)y(S,this,V).call(this);else{delete s.finishedCurrentRound;var T=i(C,this)["measure".concat(r==="download"?"Down":"Up","loadLoadedLatency")];l=new dn([K({dir:r==="download"?"down":"up"},a)],{downloadApiUrl:u,uploadApiUrl:o,estimatedServerTime:d,logApiUrl:i(C,this).logMeasurementApiUrl,measurementId:i(ct,this),measureParallelLatency:T,parallelLatencyThrottleMs:i(C,this).loadedLatencyThrottle,sessionId:i(C,this).sessionId}),l.fetchOptions={credentials:i(C,this).includeCredentials?"include":void 0},l.finishRequestDuration=i(C,this).bandwidthFinishRequestDuration,l.onNewMeasurementStarted=function(b){var k=b.count,E=b.bytes,U=s.results=Object.assign({},s.results);!U.hasOwnProperty(E)&&(U[E]={timings:[],numMeasurements:0,sideLatency:T?[]:void 0}),U[E].numMeasurements-U[E].timings.length!==k&&(U[E].numMeasurements+=k,e.onResultsChange({type:r}))},l.onMeasurementResult=function(b){var k=b.bytes,E=ae(b,ci);s.results[k].timings.push(E),s.results=Object.assign({},s.results),e.onResultsChange({type:r})},l.onParallelLatencyResult=function(b){s.results[a.bytes].sideLatency.push(b),s.results=Object.assign({},s.results),e.onResultsChange({type:r})},l.onFinished=function(b){var k=!i(C,e).measurements.slice(i(Q,e)+1).map(function(G){return G.type}).includes(r),E=Math.min.apply(Math,se(Object.values(r==="download"?b.down:b.up).slice(-1)[0].timings.map(function(G){return G.duration}))),U=k||!a.bypassMinDuration&&E>i(C,e).bandwidthFinishRequestDuration;if(!U)s.finishedCurrentRound=!0;else{s.finished=!0,e.onResultsChange({type:r});var ue=Object.keys(s.results).map(function(G){return+G}).sort(function(G,te){return te-G})[0],Z=ue*di;r==="download"&&p(et,e,Z),r==="upload"&&p(tt,e,Z)}i(oe,e)&&y(S,e,V).call(e)},l.onConnectionError=function(b){s.error=b,e.onResultsChange({type:r}),i(me,e).call(e,"Connection error while measuring ".concat(r,": ").concat(b)),y(S,e,V).call(e)},l.play()}break}p(_e,this,l),s.started=!0,this.onResultsChange({type:r})}var Xe=new WeakMap,Rt=new WeakMap,At=new WeakMap,yi=(function(e){function t(n){var r;z(this,t);for(var a=arguments.length,s=new Array(a>1?a-1:0),c=1;c<a;c++)s[c-1]=arguments[c];r=dt(this,t,[n].concat(s)),f(r,Xe,void 0),f(r,Rt,void 0),f(r,At,function(o){i(Xe,r)&&si(o,{apiUrl:i(Xe,r),sessionId:i(Rt,r)})}),j(t,"onFinish",i(At,r),r,1);var u=Object.assign({},En,n,Un);return p(Xe,r,u.logAimApiUrl),p(Rt,r,u.sessionId),r}return ft(t,e),N(t,[{key:"onFinish",set:function(r){var a=this;j(t,"onFinish",function(s){r(s),i(At,a).call(a,s)},this,1)}}])})(fi);export{yi as L,Vn as g};
