import{u as M,d as b,r as f,k as o,p as e,s as c,y as r,z as i,v as u,E as R,J as N,F as w,A as T,l as a,C as E}from"./vendor.DHFmOzci.js";import{u as j}from"./utils/utils-auth.Cj4TPQPL.js";import{t as A}from"./utils/utils-analytics.BMWz_Cy8.js";import{g as O}from"./utils/utils-data.CC01m_V6.js";import{_ as D}from"./index-CuWL2HxC.js";import"./utils/utils-getips.B2avacMe.js";import"./speedtest.Cf2juqOf.js";const B={class:"mtr-test-section my-4"},x={class:"text-secondary"},U={key:0},V={class:"row"},F={class:"col-12 mb-3"},H={class:"card-body"},J={class:"row mt-3 mb-3 align-items-center justify-content-center"},$={class:"col-12 col-md-auto"},q={for:"mtrIP",class:"col-form-label"},z={class:"col-12 col-md-auto mt-2 mt-md-0"},G={class:"input-group"},L={disabled:"",value:""},K=["value"],W=["disabled"],Z={key:0},Q={key:1,class:"spinner-grow spinner-grow-sm","aria-hidden":"true"},X={key:0,id:"mtrresult"},Y=["data-bs-theme"],tt=["id"],et=["data-bs-target","aria-expanded","aria-controls"],st={key:0},ot=["id","aria-labelledby"],rt={class:"accordion-body"},at={key:1,id:"mtrresult-error"},nt=["data-bs-theme"],lt={__name:"MtrTest",setup(ct){const{t:d}=M(),y=j(),m=b(()=>y.isDarkMode),g=b(()=>y.isMobile),C=b(()=>y.lang);let P=b(()=>y.allIPs.filter(n=>n&&!n.includes(" ")));const h=f(""),_=f({}),l=f("idle"),S=()=>{A("Section","StartClick","MTRTest"),_.value=[];let p=0;const n=async()=>{l.value="running";try{const s=await fetch("https://api.globalping.io/v1/measurements",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({limit:16,locations:[{country:"HK"},{country:"TW"},{country:"CN"},{country:"JP"},{country:"SG"},{country:"IN"},{country:"RU"},{country:"US"},{country:"CA"},{country:"AU"},{country:"GB"},{country:"DE"},{country:"FR"},{country:"BR"},{country:"ZA"},{country:"SA"}],target:h.value,type:"mtr",measurementOptions:{port:80,protocol:"ICMP"}})});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);return await s.json()}catch(s){console.error("Error sending mtr request:",s)}},t=async s=>{try{const v=await fetch(`https://api.globalping.io/v1/measurements/${s}`);if(!v.ok)throw new Error(`HTTP error! status: ${v.status}`);const k=await v.json();I(k),k.status==="in-progress"&&p<4?(setTimeout(()=>t(s),1e3),p++):_.value.length===0?l.value="error":l.value="finished"}catch(v){console.error("Error fetching mtr results:",v)}};n().then(s=>{s&&s.id&&setTimeout(()=>{t(s.id)},1e3)})},I=p=>{const n=p.results.filter(t=>t.result.status==="finished").filter(t=>t.result.rawOutput!==null).map(t=>({country:t.probe.country,country_name:O(t.probe.country,C.value),city:t.probe.city,network:t.probe.network,asn:t.probe.asn,rawOutput:t.result.rawOutput}));_.value=n};return(p,n)=>(a(),o("div",B,[e("div",x,[e("p",null,r(i(d)("mtrtest.Note")),1),g.value?c("",!0):(a(),o("p",U,r(i(d)("mtrtest.Note2")),1))]),e("div",V,[e("div",F,[e("div",{class:u(["card jn-card",{"dark-mode dark-mode-border":m.value}])},[e("div",H,[e("div",J,[e("div",$,[e("label",q,r(i(d)("mtrtest.Note3")),1)]),e("div",z,[e("div",G,[R(e("select",{id:"mtrIP","aria-label":"Select IP to MTR",class:u(["form-select jn-ping-form-select",{"bg-dark text-light":m.value}]),"onUpdate:modelValue":n[0]||(n[0]=t=>h.value=t)},[e("option",L,r(i(d)("mtrtest.SelectIP")),1),(a(!0),o(w,null,T(i(P),t=>(a(),o("option",{key:t,value:t},r(t),9,K))),128))],2),[[N,h.value]]),e("button",{class:"btn btn-primary",onClick:S,disabled:l.value==="running"||h.value===""},[l.value==="idle"||l.value==="finished"||l.value==="error"?(a(),o("span",Z,r(i(d)("mtrtest.Run")),1)):c("",!0),l.value==="running"?(a(),o("span",Q)):c("",!0)],8,W)])])]),_.value.length>0?(a(),o("div",X,[e("div",{class:"accordion",id:"mtrResults.valueAccordion","data-bs-theme":m.value?"dark":""},[(a(!0),o(w,null,T(_.value,(t,s)=>(a(),o("div",{class:"accordion-item",key:t.country},[e("h2",{class:"accordion-header",id:"heading"+s},[e("button",{class:u(["accordion-button",{collapsed:s!==0}]),type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapse"+s,"aria-expanded":s===0?"true":"false","aria-controls":"collapse"+s},[e("span",{class:u("jn-fl fi fi-"+t.country.toLowerCase())},null,2),n[1]||(n[1]=E(" ",-1)),e("strong",null,r(t.country_name)+", "+r(t.city),1),g.value?c("",!0):(a(),o("span",st," - "+r(t.network)+" ",1)),g.value?c("",!0):(a(),o("span",{key:1,class:u(["badge rounded-pill",m.value?"text-bg-warning":"text-bg-success"])},"AS"+r(t.asn),3))],10,et)],8,tt),e("div",{id:"collapse"+s,class:u(["accordion-collapse collapse",{show:s===0}]),"aria-labelledby":"heading"+s},[e("div",rt,[e("div",{class:u(["card card-body border-0 mt-3",[m.value?"bg-black text-light":"bg-light"]])},[e("pre",null,r(t.rawOutput),1)],2)])],10,ot)]))),128))],8,Y)])):c("",!0),l.value==="error"?(a(),o("div",at,[e("div",{class:"alert alert-info","data-bs-theme":m.value?"dark":""},r(i(d)("mtrtest.Error")),9,nt)])):c("",!0)])],2)])])]))}},yt=D(lt,[["__scopeId","data-v-9daf4453"]]);export{yt as default};
