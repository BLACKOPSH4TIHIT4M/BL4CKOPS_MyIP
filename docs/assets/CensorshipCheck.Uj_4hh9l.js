import{u as K,d as T,r as k,k as n,p as t,y as r,z as u,v,s as R,x as $,E as G,O as J,P as Q,F as S,A as E,K as W,T as X,l as a,C as x}from"./vendor.DHFmOzci.js";import{u as Y}from"./utils/utils-auth.Cj4TPQPL.js";import{t as H}from"./utils/utils-analytics.BMWz_Cy8.js";import{g as Z}from"./utils/utils-data.CC01m_V6.js";import{_ as ee}from"./index-CuWL2HxC.js";import"./utils/utils-getips.B2avacMe.js";import"./speedtest.Cf2juqOf.js";const te={class:"mtr-test-section my-4"},se={class:"text-secondary"},oe={class:"row"},ne={class:"col-12 mb-3"},re={class:"card-body"},ae={class:"col-12 col-md-auto"},le={for:"queryURL",class:"col-form-label"},ce={class:"input-group mb-2 mt-2"},ie=["disabled","placeholder"],ue=["disabled"],de={key:0},he={key:1,class:"spinner-grow spinner-grow-sm","aria-hidden":"true"},pe={class:"jn-placeholder"},ve={key:0,class:"text-danger"},ye={key:0,id:"censorshipresult",class:"row"},fe={class:"col-md-6 col-12"},ke={class:"fs-4 alert alert-info"},me={class:"table-responsive text-nowrap"},_e={key:0,class:"spinner-border spinner-border-sm","aria-hidden":"true"},be={class:"col-md-6 col-12"},ge={class:"fs-4 alert alert-success"},Ce={class:"table-responsive text-nowrap"},we={key:0,class:"spinner-border spinner-border-sm","aria-hidden":"true"},Re={key:0},xe=["data-bs-theme"],Te={key:0},Se={key:1},Ee={key:0},Le={key:1},Ie={class:"opacity-75 fst-italic"},Ne={__name:"CensorshipCheck",setup(Ue){const{t:l}=K(),m=Y(),C=T(()=>m.isDarkMode);T(()=>m.isMobile);const O=T(()=>m.lang),j=T(()=>m.isSignedIn),_=["CN","RU","TR","SA"],d=k([]),h=k("idle"),y=k(!1),b=k(!1),L=k([]),w=k(""),f=k(""),I=s=>{s.match(/^https?:\/\//)||(s="http://"+s);try{const e=new URL(s).hostname;if(e.match(/^[a-z0-9-]+(\.[a-z0-9-]+)*\.[a-z]{2,}$/i))return e}catch{}return f.value=l("censorshipcheck.invalidURL"),null},N=()=>{H("Section","StartClick","CensorshipCheck"),f.value="",d.value=[],h.value="idle",y.value=!1,b.value=!1,L.value=[],I(w.value)&&A()},A=()=>{H("Section","StartClick","CensorshipCheck");const s=I(w.value);if(!s)return;let o=0;const e=async()=>{h.value="running";try{const i=await fetch("https://api.globalping.io/v1/measurements",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({locations:[{country:"CN",limit:2},{country:"RU",limit:2},{country:"TR",limit:2},{country:"SA",limit:2},{country:"JP"},{country:"US"},{country:"CA"},{country:"IT"},{country:"FI"},{country:"AU"},{country:"FR"},{country:"DE"}],target:s,type:"http",measurementOptions:{request:{host:s,path:"/",method:"HEAD"},port:443,protocol:"HTTPS"}})});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);return await i.json()}catch(i){console.error("Error sending HTTP request:",i),h.value="error",f.value=l("censorshipcheck.invalidURL")}},c=async i=>{try{const g=await fetch(`https://api.globalping.io/v1/measurements/${i}`);if(!g.ok)throw new Error(`HTTP error! status: ${g.status}`);const p=await g.json();D(p),p.status==="in-progress"&&o<5?(setTimeout(()=>c(i),3e3),o++):d.value.length===0?(h.value="error",f.value=l("censorshipcheck.fetchError")):(P(),B(d.value),h.value="finished")}catch(g){console.error("Error fetching HTTP results:",g),h.value="error",f.value=l("censorshipcheck.fetchError")}};e().then(i=>{i&&i.id&&setTimeout(()=>{c(i.id)},3e3)})},D=s=>{const o=s.results.filter(e=>e.result.status==="finished"||e.result.status==="failed"||e.result.status==="in-progress").filter(e=>e.result.rawOutput!==null).map(e=>({country:e.probe.country,country_name:Z(e.probe.country,O.value),city:e.probe.city,network:e.probe.network,status:e.result.status,headers:e.result.rawHeaders?"OK":""}));d.value=o},P=()=>{d.value.forEach(s=>{s.status==="in-progress"&&(s.status="failed")}),d.value=[...d.value.sort((s,o)=>{const e=_.indexOf(s.country),c=_.indexOf(o.country);return e!==-1&&c!==-1?e-c:e!==-1?-1:c!==-1?1:s.country.localeCompare(o.country)})]},B=s=>{L.value=[],y.value=!1,b.value=!1;const o=p=>p.status==="failed"&&p.headers==="",e=_.filter(p=>{const U=s.filter(V=>V.country===p);return U.length>0&&U.every(o)}),c=s.filter(p=>!_.includes(p.country)),i=c.filter(o).length;(c.length?i/c.length:0)>.5?b.value=!0:(L.value=e,y.value=e.length>0),j.value&&q()},q=()=>{y.value&&(m.userAchievements.ItIsOpen.achieved||m.setTriggerUpdateAchievements("ItIsOpen"))},M=s=>{s.style.height="0"},z=(s,o)=>{s.classList.add("collapsing"),s.style.height="fit-content",s.addEventListener("transitionend",o)},F=(s,o)=>{s.style.height="0",s.addEventListener("transitionend",o)};return(s,o)=>(a(),n("div",te,[t("div",se,[t("p",null,r(u(l)("censorshipcheck.Note")),1)]),t("div",oe,[t("div",ne,[t("div",{class:v(["card jn-card",{"dark-mode dark-mode-border":C.value}])},[t("div",re,[t("div",ae,[t("label",le,r(u(l)("censorshipcheck.Note2")),1)]),t("div",ce,[G(t("input",{type:"text",class:v(["form-control",{"dark-mode":C.value}]),disabled:h.value==="running",placeholder:u(l)("censorshipcheck.Placeholder"),"onUpdate:modelValue":o[0]||(o[0]=e=>w.value=e),onKeyup:Q(N,["enter"]),name:"queryURL",id:"queryURL","data-1p-ignore":""},null,42,ie),[[J,w.value]]),t("button",{class:"btn btn-primary",onClick:N,disabled:h.value==="running"||!w.value},[h.value!=="running"?(a(),n("span",de,r(u(l)("censorshipcheck.Run")),1)):(a(),n("span",he))],8,ue)]),t("div",pe,[f.value?(a(),n("p",ve,r(f.value),1)):R("",!0)]),d.value.length>0?(a(),n("div",ye,[t("div",fe,[t("h3",ke,r(u(l)("censorshipcheck.TestGroup")),1),t("div",me,[t("table",{class:v(["table table-hover",{"table-dark":C.value}])},[t("thead",null,[t("tr",null,[(a(),n(S,null,E(["Country","Status","City","Network"],e=>t("th",{key:e,scope:"col"},r(u(l)("censorshipcheck."+e)),1)),64))])]),t("tbody",null,[(a(!0),n(S,null,E(d.value.filter(e=>_.includes(e.country)),(e,c)=>(a(),n("tr",{key:e.country+"-"+e.city+"-"+c},[t("td",null,[t("span",{class:v("jn-fl fi fi-"+e.country.toLowerCase())},null,2),x(" "+r(e.country_name),1)]),t("td",null,[t("i",{class:v(["bi",{"bi-x-circle-fill text-danger":e.status==="failed","bi-check-circle-fill text-success":e.status==="finished"}])},null,2),e.status==="in-progress"?(a(),n("span",_e)):R("",!0)]),t("td",null,r(e.city),1),t("td",null,r(e.network),1)]))),128))])],2)])]),t("div",be,[t("h3",ge,r(u(l)("censorshipcheck.ControlGroup")),1),t("div",Ce,[t("table",{class:v(["table table-hover",{"table-dark":C.value}])},[t("thead",null,[t("tr",null,[(a(),n(S,null,E(["Country","Status","City","Network"],e=>t("th",{key:e,scope:"col"},r(u(l)("censorshipcheck."+e)),1)),64))])]),t("tbody",null,[(a(!0),n(S,null,E(d.value.filter(e=>!_.includes(e.country)),(e,c)=>(a(),n("tr",{key:e.country+"-"+e.city+"-"+c},[t("td",null,[t("span",{class:v("jn-fl fi fi-"+e.country.toLowerCase())},null,2),x(" "+r(e.country_name),1)]),t("td",null,[t("i",{class:v(["bi",{"bi-x-circle-fill text-danger":e.status==="failed","bi-check-circle-fill text-success":e.status==="finished"}])},null,2),e.status==="in-progress"?(a(),n("span",we)):R("",!0)]),t("td",null,r(e.city),1),t("td",null,r(e.network),1)]))),128))])],2)])])])):R("",!0),$(X,{onBeforeEnter:M,onEnter:z,onLeave:F},{default:W(()=>[h.value==="finished"?(a(),n("div",Re,[t("div",{class:v(["alert",{"alert-info":b.value,"alert-danger":y.value,"alert-success":!y.value&&!b.value}]),"data-bs-theme":C.value?"dark":""},[y.value?(a(),n("span",Te,[o[1]||(o[1]=t("i",{class:"bi bi-emoji-frown"},null,-1)),x(" "+r(u(l)("censorshipcheck.isBlocked")),1)])):(a(),n("span",Se,[b.value?(a(),n("span",Le,[o[3]||(o[3]=t("i",{class:"bi bi-emoji-expressionless"},null,-1)),x(" "+r(u(l)("censorshipcheck.isDown")),1)])):(a(),n("span",Ee,[o[2]||(o[2]=t("i",{class:"bi bi-emoji-smile"},null,-1)),x(" "+r(u(l)("censorshipcheck.notBlocked")),1)]))])),t("span",Ie,"( "+r(u(l)("censorshipcheck.Note3"))+" )",1)],10,xe)])):R("",!0)]),_:1})])],2)])])]))}},qe=ee(Ne,[["__scopeId","data-v-9f62bd91"]]);export{qe as default};
